{% extends "layout.html" %}
{% block body %}
	<script type="text/javascript">
		function editProject(button, name, project_id) {
			console.log(name);
			if(button.childNodes[1].innerHTML == 'mode_edit') {
				button.parentNode.contentEditable = true;
				button.childNodes[1].innerHTML = 'done';	
			}
			else {
				button.parentNode.contentEditable = false;
				new_name = button.parentNode.childNodes[1].innerHTML + button.parentNode.childNodes[2].nodeValue;
				var data = {old_name: name, new_name:new_name};
				var dataString = JSON.stringify(data);
				console.log(dataString);
				$.ajax({
					url: "{{ request.path }}",
					type: 'POST',
					contentType: 'application/json',
					data: dataString,
					success: function(response) {
						console.log(new_name);
						console.log("Project " + project_id + " editted");
						window.location.href = "{{ url_for('dashboard') }}"				
					}	
				})
			}
		}
		function deleteProject(project_id) {
			$.ajax({
				url: "{{ url_for('dashboard') }}" + project_id,
				type: 'DELETE',
				success: function(response) {
					console.log("Deleted project");
					window.location.href = "{{ url_for('dashboard') }}"
				}
			})
		}
	</script>
	<div class="container">
		<div class="row">
		    <div class="col-sm-6 col-sm-offset-3">
			<h1>Projects</h1>
		    </div>
		    <div class="col-sm-3">
			<button id="myModal" type="button" class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored" data-toggle="modal" data-target="#add-project-modal" style="margin: 30px 0;">
			    <i class="material-icons">add</i>
			</button>
		    </div>
		</div>
		<div class="row">
			{% if error %}
				Error: {{ error }}
			{% endif %}
			<div class="col-sm-6 col-sm-offset-3">
				<table class="mdl-data-table mdl-js-data-table mdl-shadow--2dp">
					<thead>
						<tr>
							<th class="mdl-data-table__cell--non-numeric">Project Name</th>
							<th class="mdl-data-table__cell--non-numeric">Database Name</th>
							<th class="mdl-data-table__cell--non-numeric">Host</th>
							<th class="mdl-data-table__cell--non-numeric">Port</th>
							<th class="mdl-data-table__cell--non-numeric"></th>
						</tr>
					</thead>
					<tbody id="projects-table">
						{% for project in projects %}
							<tr>
								<td class="mdl-data-table__cell--non-numeric" project-id='{{ project["project_id"] }}' >
									<a href="{{ url_for('abstract_diagram', project_id=project['project_id']) }}">{{ project['name'] }}</a> {{ project['project_name'] }}
									<button class="mdl-button mdl-js-button mdl-js-ripple-effect" onclick="editProject(this, '{{ project['name'] }}', '{{ project['project_id'] }}')">
										<i class="material-icons">mode_edit</i>
									</button>
								</td>
								<td class="mdl-data-table__cell--non-numeric" project-id='{{ project["project_id"] }}' >
									{{ project['db_name'] }}
								</td>
								<td class="mdl-data-table__cell--non-numeric" project-id='{{ project["project_id"] }}' >
									{{ project['host'] }}
								</td>
								<td class="mdl-data-table__cell--non-numeric" project-id='{{ project["project_id"] }}' >
									{{ project['port'] }}
								</td>
								<td>
									<button class="mdl-button mdl-js-button mdl-js-ripple-effect" onclick="deleteProject({{ project['project_id'] }})">
										<i class="material-icons">delete</i>
									</button>
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
		    	</div>
		</div>
    </div>
    <div class="modal fade" id="add-project-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    	<div class="modal-dialog" role="document">
        	<div class="modal-content">
          		<div class="modal-header">
            		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            		<h4 class="modal-title" id="myModalLabel">Add New Project</h4>
          		</div>
          		<div class="modal-body">
            		<form id='add-project-form' action='{{ request.path }}' method=post>
            			<div class="row">
            				<div class="col-xs-10 col-xs-offset-1" style="border-bottom: 1px solid black; margin-bottom: 20px;">
								<div class="form-group">
									<label for="project_name">Project Name</label>
									<input type="text" class="form-control" name="project_name" placeholder="">
								</div>
							</div>
						</div>
						<div class="row">
            				<div class="col-xs-10 col-xs-offset-1">
								<div class="form-group">
									<label for="db_name">Database Name</label>
									<input type="text" class="form-control" name="db_name" value="oscar15_bc">
								</div>
							</div>
						</div>
						<div class="row">
            				<div class="col-xs-10 col-xs-offset-1">
								<div class="form-group">
									<label for="username">Username</label>
									<input type="text" class="form-control" name="username" value="root">
								</div>
							</div>
						</div>
						<div class="row">
            				<div class="col-xs-10 col-xs-offset-1">
								<div class="form-group">
									<label for="password">Password</label>
									<input type="password" class="form-control" name="password" value="@scar2015">
								</div>
							</div>
						</div>
						<div class="row">
            				<div class="col-xs-6 col-xs-offset-1">
								<div class="form-group">
									<label for="host">Host</label>
									<input type="text" class="form-control" name="host" value="127.0.0.1">
								</div>
							</div>
							<div class="col-xs-4">
								<div class="form-group">
									<label for="port">Port</label>
									<input type="text" class="form-control" name="port" value="3306">
								</div>
							</div>
							<div class="col-xs-10 col-xs-offset-1">
								<div class="form-group">
									<label for="port">Java Directory</label>
									<input type="text" class="form-control" name="java_directory">
								</div>
							</div>
						</div>
							<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	            			<input type="submit" id="save-project-button" class="btn btn-primary" value="Save changes">
					</form>
          		</div>
        	</div>
      	</div>
    </div>

{% endblock %}
